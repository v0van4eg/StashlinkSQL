–î–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–∞: /home/poly/PycharmProjects/StashlinkSQL

‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ nginx.conf.template
‚îú‚îÄ‚îÄ static
‚îÇ   ‚îî‚îÄ‚îÄ index.js
‚îú‚îÄ‚îÄ task.txt
‚îú‚îÄ‚îÄ templates
‚îÇ   ‚îî‚îÄ‚îÄ index.html


–°–û–î–ï–†–ñ–ò–ú–û–ï –§–ê–ô–õ–û–í:

##################################### app.py #####################################
# app.py
import os
import zipfile
import json
import shutil
from pathlib import Path
from flask import Flask, request, jsonify, render_template, send_from_directory
import uuid
import sqlite3
from datetime import datetime
import logging
import re
import unicodedata

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024 * 1024
os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


# --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
def safe_folder_name(name: str) -> str:
    """–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è –ø–∞–ø–∫–∏"""
    if not name:
        return "unnamed"
    name = unicodedata.normalize('NFKD', name)
    name = re.sub(r'[^\w\s-]', '', name, flags=re.UNICODE)
    name = re.sub(r'[-\s]+', '-', name, flags=re.UNICODE).strip('-_')
    return name[:255] if name else "unnamed"


# Initialize SQLite database
def init_db():
    conn = sqlite3.connect('files.db')
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS files (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            filename TEXT NOT NULL,
            album_name TEXT NOT NULL,
            article_number TEXT NOT NULL,
            published BOOLEAN DEFAULT FALSE,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    conn.commit()
    conn.close()


def get_albums():
    conn = sqlite3.connect('files.db')
    cursor = conn.cursor()
    cursor.execute("SELECT DISTINCT album_name FROM files")
    albums = [row[0] for row in cursor.fetchall()]
    conn.close()
    return albums


def get_articles(album_name):
    conn = sqlite3.connect('files.db')
    cursor = conn.cursor()
    cursor.execute("SELECT DISTINCT article_number FROM files WHERE album_name=?", (album_name,))
    articles = [row[0] for row in cursor.fetchall()]
    conn.close()
    return articles


def get_published_links(album_name, article_number, offset=0, limit=20):
    conn = sqlite3.connect('files.db')
    cursor = conn.cursor()
    cursor.execute("""
        SELECT filename, created_at FROM files 
        WHERE album_name=? AND article_number=? AND published=1
        ORDER BY created_at DESC LIMIT ? OFFSET ?
    """, (album_name, article_number, limit, offset))
    results = cursor.fetchall()
    conn.close()
    return results


def publish_file(filename):
    conn = sqlite3.connect('files.db')
    cursor = conn.cursor()
    cursor.execute("UPDATE files SET published=1 WHERE filename=?", (filename,))
    conn.commit()
    conn.close()


def unpublish_file(filename):
    conn = sqlite3.connect('files.db')
    cursor = conn.cursor()
    cursor.execute("UPDATE files SET published=0 WHERE filename=?", (filename,))
    conn.commit()
    conn.close()


def get_all_published_files():
    conn = sqlite3.connect('files.db')
    cursor = conn.cursor()
    cursor.execute(
        "SELECT filename, album_name, article_number, created_at FROM files WHERE published=1 ORDER BY created_at DESC")
    results = cursor.fetchall()
    conn.close()
    return results


def get_all_files():
    conn = sqlite3.connect('files.db')
    cursor = conn.cursor()
    cursor.execute(
        "SELECT filename, album_name, article_number, created_at, published FROM files ORDER BY created_at DESC")
    results = cursor.fetchall()
    conn.close()
    return results


def process_zip(zip_path):
    try:
        with zipfile.ZipFile(zip_path, 'r', metadata_encoding='utf-8') as zip_ref:
            # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∞—Ä—Ö–∏–≤–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–æ–Ω–æ —É–∂–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ)
            zip_basename = os.path.basename(zip_path)
            album_name_raw = os.path.splitext(zip_basename)[0]
            album_name = safe_folder_name(album_name_raw)

            album_path = os.path.join(app.config['UPLOAD_FOLDER'], album_name)
            os.makedirs(album_path, exist_ok=True)

            zip_ref.extractall(album_path)

            for root, dirs, files in os.walk(album_path):
                rel_path = os.path.relpath(root, album_path)
                if rel_path == '.':
                    continue

                # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∞–ø–∫–∏ –∞–ª—å–±–æ–º–∞ (–∞—Ä—Ç–∏–∫—É–ª—ã)
                if rel_path.count(os.sep) == 0:
                    article_folder_raw = os.path.basename(root)
                    article_folder_norm = safe_folder_name(article_folder_raw)

                    # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –ø–∞–ø–∫—É –∞—Ä—Ç–∏–∫—É–ª–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    original_article_path = root
                    normalized_article_path = os.path.join(os.path.dirname(root), article_folder_norm)
                    if original_article_path != normalized_article_path:
                        os.rename(original_article_path, normalized_article_path)
                        root = normalized_article_path

                    if files:
                        for file_name in files:
                            file_path = os.path.join(root, file_name)
                            if os.path.isfile(file_path):
                                relative_file_path = os.path.relpath(file_path, app.config['UPLOAD_FOLDER'])

                                conn = sqlite3.connect('files.db')
                                cursor = conn.cursor()
                                cursor.execute(
                                    "INSERT INTO files (filename, album_name, article_number) VALUES (?, ?, ?)",
                                    (relative_file_path, album_name, article_folder_norm)
                                )
                                conn.commit()
                                conn.close()

            return True
    except Exception as e:
        logger.error(f"Error processing ZIP file: {e}")
        return False


# Routes
@app.route('/')
def index():
    return render_template('index.html')


@app.route('/publinks')
def publinks():
    return render_template('publinks.html')


@app.route('/upload', methods=['POST'])
def upload_zip():
    if 'zipfile' not in request.files:
        return jsonify({'error': 'No file part'}), 400

    file = request.files['zipfile']

    if file.filename == '':
        return jsonify({'error': 'No selected file'}), 400

    if file:
        original_name = file.filename
        base_name = os.path.basename(original_name)
        name_without_ext, _ = os.path.splitext(base_name)
        safe_zip_name = safe_folder_name(name_without_ext) + '.zip'
        file_path = os.path.join(app.config['UPLOAD_FOLDER'], safe_zip_name)
        file.save(file_path)

        success = process_zip(file_path)

        if success:
            os.remove(file_path)
            return jsonify({'message': 'Files uploaded successfully'})
        else:
            return jsonify({'error': 'Failed to process ZIP file'}), 500


@app.route('/api/published')
def api_published():
    files = get_all_published_files()
    return jsonify(files)


@app.route('/api/files')
def api_files():
    files = get_all_files()
    return jsonify(files)


@app.route('/api/albums')
def api_albums():
    albums = get_albums()
    return jsonify(albums)


@app.route('/api/articles/<album_name>')
def api_articles(album_name):
    articles = get_articles(album_name)
    return jsonify(articles)


@app.route('/api/links/<album_name>/<article_number>')
def api_links(album_name, article_number):
    offset = int(request.args.get('offset', 0))
    limit = int(request.args.get('limit', 20))
    links = get_published_links(album_name, article_number, offset, limit)
    return jsonify(links)


@app.route('/api/publish/<filename>', methods=['POST'])
def api_publish(filename):
    publish_file(filename)
    return jsonify({'message': 'File published'})


@app.route('/api/unpublish/<filename>', methods=['POST'])
def api_unpublish(filename):
    unpublish_file(filename)
    return jsonify({'message': 'File unpublished'})


@app.route('/static/<path:filename>')
def static_files(filename):
    return send_from_directory(app.config['UPLOAD_FOLDER'], filename)


if __name__ == '__main__':
    init_db()
    app.run(host='0.0.0.0', port=5000, debug=True)

##################################### docker-compose.yml #####################################
---
services:
  nginx:
    image: nginx:alpine
    container_name: nginx
    ports:
      - "80:80"
    environment:
      - MAX_UPLOAD_SIZE=5000M
    volumes:
      - ./nginx.conf.template:/etc/nginx/conf.d/default.conf.template:ro
      - ./static:/app/static:ro
      - ./templates:/app/templates:ro
      - ./uploads:/app/uploads
    restart: unless-stopped
    command: >
      sh -c "
        envsubst '$$MAX_UPLOAD_SIZE' < /etc/nginx/conf.d/default.conf.template > /etc/nginx/conf.d/default.conf &&
        nginx -g 'daemon off;'
      "



##################################### nginx.conf.template #####################################
# –°–µ—Ä–≤–µ—Ä dev
server {
    listen 80;
    server_name vladimir-hp vladimir-hp.gradient.ru tecnobook;
    client_max_body_size ${MAX_UPLOAD_SIZE};

    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
    location /admin {
#        auth_basic "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª";
#        auth_basic_user_file /etc/nginx/htpasswd;
        proxy_pass http://localhost:5000/admin;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        # --- –ù–û–í–û–ï: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ ---
        proxy_connect_timeout       300s; # –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º
        proxy_send_timeout          300s; # –¢–∞–π–º–∞—É—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∑–∞–ø–∏—Å–∏ –≤ –±—ç–∫–µ–Ω–¥
        proxy_read_timeout          300s; # –¢–∞–π–º–∞—É—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ —á—Ç–µ–Ω–∏—è –∏–∑ –±—ç–∫–µ–Ω–¥–∞
        # --- /–ù–û–í–û–ï ---
    }

    # –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    location /images/ {
        alias /app/uploads/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin "*";
    }

    location /static/ {
        alias /app/static/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    location = / {
        root /app/templates;
        try_files /hello.html =404;
    }
}

# –°–µ—Ä–≤–µ—Ä –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ –Ω–∞ gradient.ru
server {
    listen 80;
    server_name stashlink.gradient.ru;
    client_max_body_size ${MAX_UPLOAD_SIZE};

    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
    location /admin {
        auth_basic "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª";
        auth_basic_user_file /etc/nginx/htpasswd;
        proxy_pass http://localhost:5000/admin;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
            # --- –ù–û–í–û–ï: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ ---
        proxy_connect_timeout       300s; # –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º
        proxy_send_timeout          300s; # –¢–∞–π–º–∞—É—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∑–∞–ø–∏—Å–∏ –≤ –±—ç–∫–µ–Ω–¥
        proxy_read_timeout          300s; # –¢–∞–π–º–∞—É—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ —á—Ç–µ–Ω–∏—è –∏–∑ –±—ç–∫–µ–Ω–¥–∞
        # --- /–ù–û–í–û–ï ---
    }

    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    location /static/ {
        alias /app/static/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    location = / {
        root /app/templates;
        try_files /hello.html =404;
    }
}

# –°–µ—Ä–≤–µ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ mooo.com
server {
    listen 80;
    server_name stashlink.mooo.com;
    client_max_body_size ${MAX_UPLOAD_SIZE};

    # –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    location /images/ {
        alias /app/uploads/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin "*";
    }

    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    location /static/ {
        alias /app/static/;
        expires 30d;
    }

    # –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –ø—É—Ç–∏ - –æ—Ç–¥–∞—á–∞ hello.html
    location = / {
        root /app/templates;
        try_files /hello.html =404;
    }

    # –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    location / {
        return 301 /;
    }
}

# –°–µ—Ä–≤–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ IP
server {
    listen 80 default_server;
    server_name _;
    client_max_body_size ${MAX_UPLOAD_SIZE};

    # –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –ø—É—Ç–∏ - –æ—Ç–¥–∞—á–∞ hello.html
    location = / {
        root /app/templates;
        try_files /hello.html =404;
    }

    # –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ç–æ–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç hello.html
    location / {
        root /app/templates;
        try_files /hello.html =404;
    }
}


##################################### task.txt #####################################
album.zip
    ‚îú‚îÄ‚îÄ article1/
    ‚îÇ   ‚îú‚îÄ‚îÄ article1_num1.jpg
    ‚îÇ   ‚îî‚îÄ‚îÄ article2_num2.jpg
    ‚îî‚îÄ‚îÄ article2/
    ‚îÇ   ‚îú‚îÄ‚îÄ article1_num1.jpg
    ‚îÇ   ‚îî‚îÄ‚îÄ article2_num2.jpg


##################################### static/index.js #####################################
// static/index.js

const Path = {
    basename: (path) => {
        const parts = path.split(/[\\/]/);
        return parts[parts.length - 1] || path;
    }
};

// DOM elements
const dropArea = document.getElementById('dropArea');
const zipFileInput = document.getElementById('zipFile');
const browseBtn = document.getElementById('browseBtn');
const uploadBtn = document.getElementById('uploadBtn');
const uploadForm = document.getElementById('uploadForm');
const linkList = document.getElementById('linkList');
const currentAlbumTitle = document.getElementById('currentAlbumTitle');

let droppedFile = null;
let currentAlbumName = null;

// Prevent default drag behaviors
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, preventDefaults, false);
    document.body.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
}

// Highlight drop area
['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.add('drag-over'), false);
});

['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.remove('drag-over'), false);
});

// Handle drop
dropArea.addEventListener('drop', (e) => {
    const file = e.dataTransfer.files[0];
    if (file && file.name.toLowerCase().endsWith('.zip')) {
        droppedFile = file;
        updateUI();
    } else {
        alert('Please drop a valid ZIP file.');
    }
});

// File input and browse button
browseBtn.addEventListener('click', () => zipFileInput.click());
zipFileInput.addEventListener('change', () => {
    droppedFile = null;
    updateUI();
});

function updateUI() {
    const file = droppedFile || (zipFileInput.files[0] || null);
    if (file) {
        dropArea.innerHTML = `<p>Selected: <strong>${file.name}</strong></p><p>Ready to upload</p>`;
        uploadBtn.disabled = false;
    } else {
        dropArea.innerHTML = `<p>Drag & drop your ZIP file here</p><p>or</p><button type="button" class="btn" id="browseBtn">Browse Files</button>`;
        uploadBtn.disabled = true;
        setTimeout(() => {
            const newBrowseBtn = document.getElementById('browseBtn');
            if (newBrowseBtn) {
                newBrowseBtn.addEventListener('click', () => zipFileInput.click());
            }
        }, 0);
    }
}

// Upload form submission
uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const file = droppedFile || zipFileInput.files[0];
    if (!file || !file.name.toLowerCase().endsWith('.zip')) {
        alert('Please select a valid ZIP file.');
        return;
    }

    const formData = new FormData();
    formData.append('zipfile', file, file.name);

    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<span>Uploading...</span>';

    try {
        const response = await fetch('/upload', { method: 'POST', body: formData });
        const data = await response.json();
        if (!response.ok) throw new Error(data.error || `HTTP ${response.status}`);

        // –í–æ—Å—Å–æ–∑–¥–∞—ë–º –∏–º—è –∞–ª—å–±–æ–º–∞ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
        let albumName = file.name.replace(/\.zip$/i, '');
        albumName = albumName.normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '') // remove accents
            .replace(/[^\w\s-]/g, '')         // remove unsafe chars
            .replace(/[-\s]+/g, '-')          // spaces/dashes ‚Üí single dash
            .replace(/^-+|-+$/g, '')          // trim dashes
            .substring(0, 255) || 'unnamed';

        currentAlbumName = albumName;
        showFilesForAlbum(albumName);
        alert('Upload successful!');
    } catch (error) {
        console.error('Upload failed:', error);
        alert(`Upload failed: ${error.message}`);
    } finally {
        uploadBtn.disabled = false;
        uploadBtn.innerHTML = '<span>Upload Archive</span>';
        zipFileInput.value = '';
        droppedFile = null;
        updateUI();
    }
});

// Load and display files for a specific album
async function showFilesForAlbum(albumName) {
    currentAlbumTitle.textContent = `Files in "${albumName}"`;
    try {
        const response = await fetch('/api/files');
        if (!response.ok) throw new Error('Failed to load file list');
        const allFiles = await response.json();

        // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∏–º–µ–Ω–∏ –∞–ª—å–±–æ–º–∞ (item[1] = album_name)
        const albumFiles = allFiles.filter(item => item[1] === albumName);

        if (albumFiles.length === 0) {
            linkList.innerHTML = '<div class="empty-state">No files found in this album.</div>';
            return;
        }

        linkList.innerHTML = '';
        albumFiles.forEach(item => {
            const li = document.createElement('li');
            li.className = 'link-item';

            const link = document.createElement('a');
            // –í–ê–ñ–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ü–û–õ–ù–´–ô –ø—É—Ç—å item[0] ‚Äî –æ–Ω –≤–∫–ª—é—á–∞–µ—Ç album/article/file.jpg
            link.href = `/static/${item[0]}`; // ‚Üê –ù–ï–¢ encodeURIComponent!
            link.target = '_blank';
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º: article / filename
            link.textContent = `${item[2]} / ${Path.basename(item[0])}`;
            li.appendChild(link);

            linkList.appendChild(li);
        });
    } catch (error) {
        console.error('Error loading files:', error);
        linkList.innerHTML = `<div class="empty-state">Error loading files for "${albumName}".</div>`;
    }
}

// Initial state
linkList.innerHTML = '<div class="empty-state">Upload a ZIP archive to see files.</div>';


##################################### templates/index.html #####################################
<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StashLink ‚Äî Upload & Manage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: #f8f9fa;
            color: #333;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 24px;
        }
        h1 {
            font-size: 2.2rem;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .columns {
            display: flex;
            gap: 24px;
        }

        .column-left {
            flex: 0 0 25%;
            min-width: 0;
        }

        .column-right {
            flex: 1;
            min-width: 0;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            padding: 24px;
            height: fit-content;
        }

        .upload-area {
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
            margin-bottom: 20px;
        }
        .upload-area:hover, .upload-area.drag-over {
            border-color: #3498db;
            background: #f0f8ff;
        }
        .file-input {
            display: none;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .btn-success {
            background: #2ecc71;
        }
        .btn-success:hover {
            background: #27ae60;
        }

        .links-section h2 {
            margin-bottom: 16px;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .link-list {
            list-style: none;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 8px;
        }
        .link-item {
            padding: 12px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        .link-item:last-child {
            border-bottom: none;
        }
        .link-item a {
            color: #3498db;
            text-decoration: none;
            word-break: break-all;
            display: block;
        }
        .link-item a:hover {
            text-decoration: underline;
        }

        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: #95a5a6;
        }

        @media (max-width: 900px) {
            .columns {
                flex-direction: column;
            }
            .column-left,
            .column-right {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìÅ StashLink</h1>
            <p class="subtitle">Upload ZIP archives and manage your file links</p>
        </header>

        <div class="columns">
            <div class="column-left">
                <div class="card">
                    <h2>üì§ Upload ZIP Archive</h2>
                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="upload-area" id="dropArea">
                            <p>Drag & drop your ZIP file here</p>
                            <p>or</p>
                            <button type="button" class="btn" id="browseBtn">Browse Files</button>
                            <input type="file" id="zipFile" name="zipfile" accept=".zip" class="file-input">
                        </div>
                        <button type="submit" class="btn" id="uploadBtn" disabled>
                            <span>Upload Archive</span>
                        </button>
                    </form>
                </div>
            </div>

            <div class="column-right">
                <div class="card links-section">
                    <h2>
                        <span id="currentAlbumTitle">All Files</span>
                        <button id="generateBtn" class="btn btn-success" style="padding: 6px 12px; font-size: 0.9rem;">Generate XLSX</button>
                    </h2>
                    <ul id="linkList" class="link-list">
                        <div class="empty-state">Upload a ZIP archive to see files.</div>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/index.js"></script>
</body>
</html>

